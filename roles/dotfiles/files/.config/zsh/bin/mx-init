#!/usr/bin/env sh
set -e

SESSION='_shared'

create_session() {
  tmux new-session -d -s "$SESSION"

  if type neomutt >/dev/null; then
    tmux new-window -n 'mail'
    tmux send-keys "neomutt" C-m
  fi

  if type newsboat >/dev/null; then
    tmux new-window -n 'rss'
    tmux send-keys "newsboat" C-m
  fi

  if type newsboat >/dev/null; then
    tmux new-window -n 'reddit'
    tmux send-keys "tuir" C-m
  fi

  if type weechat >/dev/null; then
    tmux new-window -n 'weechat'
    # Stop Weechat from renaming the window
    tmux set-option allow-rename off
    tmux send-keys "weechat" C-m
  fi

  logpath="$PROJECTS"/knowledge
  if [ -d "$logpath" ]; then
    tmux new-window -n 'log' -c "$logpath"
    tmux send-keys "$EDITOR" C-m
    tmux split-window -h -p 15 -c "$logpath"
  fi

  if [ -d "$DOTFILES" ]; then
    tmux new-window -n 'dotfiles' -c "$DOTFILES"
    tmux send-keys "$EDITOR" C-m
    tmux split-window -h -p 15 -c "$DOTFILES"
  fi
}

if ! (tmux list-sessions | cut -d ':' -f 1 | grep -q ^"$SESSION"\$); then
  create_session
fi
